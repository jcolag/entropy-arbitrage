---
layout: post
title: Firefox's Tabs
date: 2025-05-21 06:43:05-0400
categories:
tags: [programming, tech-tips]
summary: Accessing browser tabs without the browser
thumbnail: /blog/assets/5972893184_24bea5eff2_o.png
offset: -26%
description: Exploring the storage behind tabs.
update: [
  2025-05-14-firefox-local-storage.md
]
spell: CAPTCHAs sessionstore jq newtab xdg fi lastAccessed
proofed: true
---

* Ignore for ToC
{:toc}

Since I posted about some Firefox nonsense [last week]({% post_url 2025-05-14-firefox-local-storage %}), it occurred to me that I should probably also note the other bit of research into Firefox's internal storage that I dug through.

![Folders in a filing cabinet with their label-tabs sticking up, centered on one reading NO](/blog/assets/5972893184_24bea5eff2_o.png "But also yes...")

Again, I mostly do this for my own memory, though it might prove useful for somebody else.

## Motivation

In contrast to last week, this project has a far cleaner reason to investigate:  When I have a post that needs to go out, I run two scripts.  The first script rebuilds the blog---especially the [tags](/blog/tags)---and pushes the result up to the server.  The other script sets up to announce the new post, assembling the social media posts from the blog post metadata, then opening the social media websites of note in my browser.

Doing this can cause *one* conflict.  [Buy Me a Coffee](https://www.buymeacoffee.com/jcolag) does what I'd call bizarre things with browser cookies.  It *loves* to log people out, for some reason.  If you close the tab, it logs you out.  If you leave the tab open and don't touch it for twenty-four hours, it logs you out.  And if you leave the tab open and check in every few hours to stay logged in, but open the site in a new tab, it logs you out.  It also doesn't work well with [my password manager](https://www.passwordstore.org/) for whatever reason, and keeps adding CAPTCHAs, so forcibly logging out can feel like a personal attack.

Therefore, I wanted that aforementioned second script to only open Buy Me a Coffee in the browser *if* the browser doesn't already have the site open.

## Finding the Tabs

Unlike the search for the Local Storage files, last week, Firefox keeps the tab information in a single, standard file with a clear name and path, `<whatever-profile>/sessionstore-backups/recovery.jsonlz4`.  As you can probably guess by the folder name, it stores this information so that Firefox can restore the open tabs on startup, usually after an unexpected closure.

Notice the filename's extension, though.  We have JSON, but compressed with [LZ4](https://en.wikipedia.org/wiki/LZ4_%28compression_algorithm%29).  I compiled [lz4json](https://github.com/andikleen/lz4json), which...oh, let's let the author explain.

> A little utility to unpack lz4json files as generated by Firefox's bookmark backups and session restore.  This is a different format from what the normal lz4 utility expects.

In other words, it works with exactly the sorts of files that we want, here, which means less effort than if I had stumbled on some generic LZ4 application suite.

## Getting the Tab List

Running `lz4jsoncat recovery.jsonlz4`---to nobody's surprise---gives us the full JSON that Firefox uses to store the state of the tabs.  It includes some versioning information, information about multiple windows and closed tabs/windows, groups, the session, cookies, open tools, and most important for these purposes, the `.windows` property.

That property includes a `.tabs` property, among bunches of other information.  Each tab contains `.entries`, which indicates the history of the tab---the list of pages so that you can click *Back* on a tab after recovering from a crash---the last access time, whether you pinned or hid the tab, some less-interesting information, what looks like the history index, information on fill-in forms on the page, the scroll position, and (probably) the "favorites" icon for the tab.

This allows us to run something like this.

```console
lz4jsoncat recovery.jsonlz4 | jq -r .windows[].tabs[].entries[0].url
```

Plus or minus some uninteresting `about:newtab` entries, this provides a list of the URL in each open tab.

## Final Check

To sort of close the loop and show how we take care of the original stated problem, we can now do something like this to decide whether to open Buy Me a Coffee in the browser.

```console
recovery=$(find ~/.mozilla/firefox -name "recovery.jsonlz4" -print)
tabs=$(lz4jsoncat "${recovery}" | jq -r .windows[].tabs[].entries[0].url)

if grep -q 'buymeacoffee.com' <<< "${tabs}"
then
  echo Already open!
else
  xdg-open https://www.buymeacoffee.com/app/dashboard
fi
```

That works well enough for the purpose.

## More Than That

Looking at the data available, I can see much more potential, now that we have this core utility of grabbing the open tabs.

For example, given how many people complain about tab management and asking how many tabs qualifies as "too darn many" tabs, I assume that I don't stand alone in opening a page for some specific project, then getting pulled onto another project (or only distracted), and then leaving the tab open more or less forever, forgetting about the original reasons for the tab.  It occurs to me, now, that my [**Morning Dashboard**](https://github.com/jcolag/dash) could pull out the list of open tabs and the tab's `.lastAccessed` property to identify tabs (and probably projects) that I should either get back to or bookmark the page and close the tab.

Likewise, when I generate the newsletter, the scripts could---probably won't, but could---embarrass me every month by linking to the oldest tabs.

And I'd bet that somebody could do much more with that data, given enough time reviewing what it provides...

* * *

**Credits**:  The header image is [no](https://www.flickr.com/photos/29096601@N00/5972893184) by [Tom Woodward](https://www.flickr.com/photos/bionicteaching/), made available under the terms of the [Creative Commons Attribution Share-Alike 2.0 Generic](https://creativecommons.org/licenses/by-sa/2.0/deed.en) license.
